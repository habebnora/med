image: node:20

stages:
  - build

cache:
  paths:
    - node_modules/

before_script:
  - apt-get update -y
  - apt-get install -y git

build_android:
  stage: build
  script:
    # Install dependencies and build the web project
    - npm install
    - npm run build

    # Install Capacitor and ensure Android platform is set up
    - npm install @capacitor/core @capacitor/cli
    - npx cap add android
    - npx cap sync

    # Build the Android APK (Debug version)
    - cd android
    - chmod +x ./gradlew
    - ./gradlew assembleDebug

  artifacts:
    paths:
      - android/app/build/outputs/apk/debug/app-debug.apk
    expire_in: 1 week